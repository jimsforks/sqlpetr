<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using DiagrammeR with Bookdown • sqlpetr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using DiagrammeR with Bookdown">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sqlpetr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/using-diagrammer-with-bookdown.html">Using DiagrammeR with Bookdown</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smithjd/sqlpetr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="using-diagrammer-with-bookdown_files/htmlwidgets-1.3/htmlwidgets.js"></script><script src="using-diagrammer-with-bookdown_files/viz-0.3/viz.js"></script><link href="using-diagrammer-with-bookdown_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="using-diagrammer-with-bookdown_files/grViz-binding-1.0.0/grViz.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using DiagrammeR with Bookdown</h1>
                        <h4 class="author">M. Edward (Ed) Borasky</h4>
            
            <h4 class="date">2018-10-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/smithjd/sqlpetr/blob/master/vignettes/using-diagrammer-with-bookdown.Rmd"><code>vignettes/using-diagrammer-with-bookdown.Rmd</code></a></small>
      <div class="hidden name"><code>using-diagrammer-with-bookdown.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This project consists of two repositories:</p>
<ol style="list-style-type: decimal">
<li>
<a href="https://github.com/smithjd/sql-pet" class="uri">https://github.com/smithjd/sql-pet</a> - an eBook <span class="citation">(Muni et al. 2018a)</span> we are building using Bookdown <span class="citation">(Xie 2016)</span>
</li>
<li>
<a href="https://github.com/smithjd/sqlpetr" class="uri">https://github.com/smithjd/sqlpetr</a> - an R package <span class="citation">(Muni et al. 2018b)</span> containing two classes of functions:
<ol style="list-style-type: decimal">
<li>Utilities for managing the subject matter of the book - Docker images and containers, and PostgreSQL databases running in the containers.</li>
<li>Utilities for building the book.</li>
</ol>
</li>
</ol>
<p>Our workflow is:</p>
<ol style="list-style-type: decimal">
<li>Clone the repositories.</li>
<li>Install the <code>sqlpetr</code> package by sourcing the file <code>install_me.R</code>. This installs the package, all the dependencies needed to work on the package, and all of the dependencies needed to build the book and run the code samples in the book. It also rebuilds the <code>pkgdown</code> site for <code>sqlpetr</code>.</li>
<li>Edit the book using the Bookdown tools in RStudio. If we find an operation we perform repeatedly in the edit cycle, we’ll often migrate that code into a function in <code>sqlpetr</code>. This vignette documents one such function.</li>
</ol>
<p>We maintain the book in two forms - the Bookdown “GitBook” HTML format and as a PDF file. The HTML book is deployed to GitHub Pages at <a href="https://smithjd.github.io/sql-pet" class="uri">https://smithjd.github.io/sql-pet</a> and the PDF is downloadable from a button at the top of the HTML book.</p>
<p>To create some of the graphics in the book, we use the <code>DiagrammeR</code> package. The remainder of this vignette describes how we use it.</p>
</div>
<div id="making-a-diagram-with-diagrammer" class="section level2">
<h2 class="hasAnchor">
<a href="#making-a-diagram-with-diagrammer" class="anchor"></a>Making a diagram with DiagrammeR</h2>
<p><code>DiagrammeR</code> <span class="citation">(Iannone 2018)</span> is a package for creating diagrams with R code. There are essentially two ways to create a diagram:</p>
<ol style="list-style-type: decimal">
<li>Manually, by editing a text file or text string and previewing it in RStudio, (<a href="http://rich-iannone.github.io/DiagrammeR/io.html" class="uri">http://rich-iannone.github.io/DiagrammeR/io.html</a>), or</li>
<li>Programmatically, by writing R code that creates a graph object and then rendering it with <code>render_graph</code>.</li>
</ol>
<p>Both of these will work in an R Markdown document that’s deployed to HTML. In fact, they also work in the HTML-based “GitBook” output from Bookdown. And in the first case, there’s no code required except the description of the diagram in the <code>DOT</code> language (<a href="http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html" class="uri">http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html</a>).</p>
<p>For the <em>programmatic</em> workflow, <code>DiagrammeR</code> can export a graph object to image files, which <code>knitr</code> can import into both the HTML and PDF versions of a book. But there’s no easy way to go from the manual text description to image files. So we built one.</p>
</div>
<div id="exporting-a-grvis-object-to-image-files" class="section level2">
<h2 class="hasAnchor">
<a href="#exporting-a-grvis-object-to-image-files" class="anchor"></a>Exporting a <code>grVis</code> object to image files</h2>
<p>When you create a diagram manually, <code>DiagrammeR</code> returns a <code>grViz</code> object. The actual diagram is coded as a Scalable Vector Graphics (SVG) text string, and the rest of the object is metadata.</p>
<p>When you create a diagram programmatically, <code>render_graph</code> returns a <code>grViz</code> object, given a (computed) graph object in an internal <code>DiagrammeR</code> format. So in either case, we have an <code>htmlwidget</code> object.</p>
<p>Here’s an example (<a href="http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html" class="uri">http://rich-iannone.github.io/DiagrammeR/graphviz_and_mermaid.html</a>):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">DiagrammeR<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DiagrammeR/topics/grViz">grViz</a></span>(<span class="st">"</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="st">digraph nicegraph {</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">  # graph, node, and edge definitions</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">  graph [compound = true, nodesep = .5, ranksep = .25,</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="st">         color = crimson]</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="st">  node [fontname = Helvetica, fontcolor = darkslategray,</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">        shape = rectangle, fixedsize = true, width = 1,</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">        color = darkslategray]</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="st">  edge [color = grey, arrowhead = none, arrowtail = none]</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="st">  # subgraph for R information</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st">  subgraph cluster0 {</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="st">    node [fixedsize = true, width = 3]</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st">    '@@1-1' -&gt; '@@1-2' -&gt; '@@1-3' -&gt; '@@1-4'</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="st">    '@@1-4' -&gt; '@@1-5' -&gt; '@@1-6' -&gt; '@@1-7'</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="st">  }</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="st">  # subgraph for RStudio information</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="st">  subgraph cluster1 {</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="st">    node [fixedsize = true, width = 3]</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="st">    '@@2' -&gt; '@@3'</span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="st">  }</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="st">  Information             [width = 1.5]</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="st">  Information -&gt; R</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="st">  Information -&gt; RStudio</span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="st">  R -&gt; '@@1-1'            [lhead = cluster0]</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="st">  RStudio -&gt; '@@2'        [lhead = cluster1]</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="st">}</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="st">[1]: paste0(names(R.Version())[1:7], ':</span><span class="ch">\\</span><span class="st">n ', R.Version()[1:7])</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="st">[2]: paste0('RStudio version:</span><span class="ch">\\</span><span class="st">n ', '1.2.1062')</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"><span class="st">[3]: paste0('Current program mode:</span><span class="ch">\\</span><span class="st">n ', 'desktop')</span></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"><span class="st">"</span>)</a></code></pre></div>
<div id="htmlwidget-4b6b98a965a13c0b7934" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-4b6b98a965a13c0b7934">{"x":{"diagram":"\ndigraph nicegraph {\n\n  # graph, node, and edge definitions\n  graph [compound = true, nodesep = .5, ranksep = .25,\n         color = crimson]\n\n  node [fontname = Helvetica, fontcolor = darkslategray,\n        shape = rectangle, fixedsize = true, width = 1,\n        color = darkslategray]\n\n  edge [color = grey, arrowhead = none, arrowtail = none]\n\n  # subgraph for R information\n  subgraph cluster0 {\n    node [fixedsize = true, width = 3]\n    \"platform:\n x86_64-pc-linux-gnu\" -> \"arch:\n x86_64\" -> \"os:\n linux-gnu\" -> \"system:\n x86_64, linux-gnu\"\n    \"system:\n x86_64, linux-gnu\" -> \"status:\n \" -> \"major:\n 3\" -> \"minor:\n 5.1\"\n  }\n\n  # subgraph for RStudio information\n  subgraph cluster1 {\n    node [fixedsize = true, width = 3]\n    \"RStudio version:\n 1.2.1062\" -> \"Current program mode:\n desktop\"\n  }\n\n  Information             [width = 1.5]\n  Information -> R\n  Information -> RStudio\n  R -> \"platform:\n x86_64-pc-linux-gnu\"            [lhead = cluster0]\n  RStudio -> \"RStudio version:\n 1.2.1062\"        [lhead = cluster1]\n\n}","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p>Since this vignette is HTML, you can see the diagram. But to make both HTML and PDF, we need image files that <code>knitr</code> can import. For that, we’ll need two more packages: <code>DiagrammeRsvg</code> (<span class="citation">Iannone (2016)</span>) and <code>magick</code> (<span class="citation">Ooms (2018)</span>).</p>
<p>First, create a directory for the images:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">dir.create</span>(<span class="st">"diagrams"</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; Warning in dir.create("diagrams", recursive = TRUE): 'diagrams' already</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; exists</span></a></code></pre></div>
<p>Create an <code>htmlwidget</code> object from the graph DOT text using <code><a href="http://www.rdocumentation.org/packages/DiagrammeR/topics/grViz">DiagrammeR::grViz</a></code></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">widget &lt;-<span class="st"> </span>DiagrammeR<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DiagrammeR/topics/grViz">grViz</a></span>(<span class="st">"</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">digraph nicegraph {</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  # graph, node, and edge definitions</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  graph [compound = true, nodesep = .5, ranksep = .25,</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">         color = crimson]</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">  node [fontname = Helvetica, fontcolor = darkslategray,</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="st">        shape = rectangle, fixedsize = true, width = 1,</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="st">        color = darkslategray]</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="st">  edge [color = grey, arrowhead = none, arrowtail = none]</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">  # subgraph for R information</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">  subgraph cluster0 {</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="st">    node [fixedsize = true, width = 3]</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="st">    '@@1-1' -&gt; '@@1-2' -&gt; '@@1-3' -&gt; '@@1-4'</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="st">    '@@1-4' -&gt; '@@1-5' -&gt; '@@1-6' -&gt; '@@1-7'</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="st">  }</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"></a>
<a class="sourceLine" id="cb3-21" data-line-number="21"><span class="st">  # subgraph for RStudio information</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="st">  subgraph cluster1 {</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="st">    node [fixedsize = true, width = 3]</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="st">    '@@2' -&gt; '@@3'</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="st">  }</span></a>
<a class="sourceLine" id="cb3-26" data-line-number="26"></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="st">  Information             [width = 1.5]</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28"><span class="st">  Information -&gt; R</span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="st">  Information -&gt; RStudio</span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="st">  R -&gt; '@@1-1'            [lhead = cluster0]</span></a>
<a class="sourceLine" id="cb3-31" data-line-number="31"><span class="st">  RStudio -&gt; '@@2'        [lhead = cluster1]</span></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"></a>
<a class="sourceLine" id="cb3-33" data-line-number="33"><span class="st">}</span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="st">[1]: paste0(names(R.Version())[1:7], ':</span><span class="ch">\\</span><span class="st">n ', R.Version()[1:7])</span></a>
<a class="sourceLine" id="cb3-36" data-line-number="36"><span class="st">[2]: paste0('RStudio version:</span><span class="ch">\\</span><span class="st">n ', '1.2.1062')</span></a>
<a class="sourceLine" id="cb3-37" data-line-number="37"><span class="st">[3]: paste0('Current program mode:</span><span class="ch">\\</span><span class="st">n ', 'desktop')</span></a>
<a class="sourceLine" id="cb3-38" data-line-number="38"></a>
<a class="sourceLine" id="cb3-39" data-line-number="39"><span class="st">"</span>)</a></code></pre></div>
<p>Extract the SVG code for the diagram and write it to a file:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10">widget <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="st">  </span>DiagrammeRsvg<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DiagrammeRsvg/topics/export_svg">export_svg</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="st">  </span><span class="kw">cat</span>(<span class="dt">file =</span> <span class="st">"diagrams/example.svg"</span>)</a></code></pre></div>
<p>If you have an SVG viewer, like <code>Inkscape</code>, you can open the file and see the diagram!</p>
<p>Now, create a <code>.png</code> for importing to HTML and a <code>.pdf</code> for importing into PDFs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">magick<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/magick/topics/editing">image_read_svg</a></span>(<span class="st">"diagrams/example.svg"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="st">  </span>magick<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/magick/topics/editing">image_write</a></span>(</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">    <span class="dt">path =</span> <span class="st">"diagrams/example.png"</span>, </a>
<a class="sourceLine" id="cb5-4" data-line-number="4">    <span class="dt">format =</span> <span class="st">"png"</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">magick<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/magick/topics/editing">image_read_svg</a></span>(<span class="st">"diagrams/example.svg"</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="st">  </span>magick<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/magick/topics/editing">image_write</a></span>(</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">    <span class="dt">path =</span> <span class="st">"diagrams/example.pdf"</span>, <span class="dt">format =</span> <span class="st">"pdf"</span>)</a></code></pre></div>
</div>
<div id="including-the-image-in-the-book" class="section level2">
<h2 class="hasAnchor">
<a href="#including-the-image-in-the-book" class="anchor"></a>Including the image in the book</h2>
<p>That was the hard part - it’s downhill from here. A single <code>knitr</code> call is all we need to get the image displayed in our R Markdown either in an HTML or PDF document.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">dpi &lt;-<span class="st"> </span><span class="dv">96</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/include_graphics">include_graphics</a></span>(<span class="st">"diagrams/example.png"</span>, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>, <span class="dt">dpi =</span> dpi)</a></code></pre></div>
<p><img src="diagrams/example.png"><!-- --></p>
<p>How does this work? We have both <code>.png</code> and <code>.pdf</code> files for the image. <code>knitr</code> sees the <code>auto_pdf</code> option and makes the choice accordingly. If it’s making an HTML file it uses the <code>.png</code> and if it’s making a PDF file it uses the <code>.pdf</code>.</p>
</div>
<div id="so-lets-make-this-into-a-function" class="section level2">
<h2 class="hasAnchor">
<a href="#so-lets-make-this-into-a-function" class="anchor"></a>So let’s make this into a function!</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">sqlpetr<span class="op">::</span>sp_make_image_files</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; function (widget, directory, filename) </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; {</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;     dir.create(directory, recursive = TRUE, showWarnings = FALSE)</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;     svg_name &lt;- paste(directory, paste(filename, "svg", sep = "."), </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;         sep = "/")</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;     png_name &lt;- paste(directory, paste(filename, "png", sep = "."), </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;         sep = "/")</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;     pdf_name &lt;- paste(directory, paste(filename, "pdf", sep = "."), </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;         sep = "/")</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;     widget %&gt;% DiagrammeRsvg::export_svg() %&gt;% cat(file = svg_name)</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;     magick::image_read_svg(svg_name) %&gt;% magick::image_write(path = png_name, </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;         format = "png")</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;     magick::image_read_svg(svg_name) %&gt;% magick::image_write(path = pdf_name, </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;         format = "pdf")</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;     return(png_name)</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt; }</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt; &lt;bytecode: 0x55eea2822748&gt;</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt; &lt;environment: namespace:sqlpetr&gt;</span></a></code></pre></div>
<p>Test it!</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">file_to_include &lt;-<span class="st"> </span>sqlpetr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sqlpetr/topics/sp_make_image_files">sp_make_image_files</a></span>(widget, <span class="st">"diagrams"</span>, <span class="st">"example"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/include_graphics">include_graphics</a></span>(<span class="dt">path =</span> file_to_include, <span class="dt">auto_pdf =</span> <span class="ot">TRUE</span>, <span class="dt">dpi =</span> dpi)</a></code></pre></div>
<p><img src="diagrams/example.png"><!-- --></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Iannone2016">
<p>Iannone, Richard. 2016. <em>DiagrammeRsvg: Export Diagrammer Graphviz Graphs as Svg</em>. <a href="https://CRAN.R-project.org/package=DiagrammeRsvg">https://CRAN.R-project.org/package=DiagrammeRsvg</a>.</p>
</div>
<div id="ref-Iannone2018">
<p>———. 2018. <em>DiagrammeR: Graph/Network Visualization</em>. <a href="http://rich-iannone.github.io/DiagrammeR/index.html">http://rich-iannone.github.io/DiagrammeR/index.html</a>.</p>
</div>
<div id="ref-Muni2018a">
<p>Muni, Dipti, Mary Anne Thygesen, Sophie Yang, Jim Tyhurst, John David Smith, and M. Edward (Ed) Borasky. 2018a. <em>R, Databases and Docker</em>. <a href="https://smithjd.github.io/sql-pet">https://smithjd.github.io/sql-pet</a>.</p>
</div>
<div id="ref-Muni2018b">
<p>———. 2018b. <em>Sqlpetr: Companion Package for R-Docker-Databases Book</em>. <a href="https://github.com/smithjd/sqlpetr">https://github.com/smithjd/sqlpetr</a>.</p>
</div>
<div id="ref-Ooms2018">
<p>Ooms, Jeroen. 2018. <em>Magick: Advanced Graphics and Image-Processing in R</em>. <a href="https://CRAN.R-project.org/package=magick">https://CRAN.R-project.org/package=magick</a>.</p>
</div>
<div id="ref-Xie2016">
<p>Xie, Yihui. 2016. <em>Bookdown: Authoring Books and Technical Documents with R Markdown</em>. Boca Raton, Florida: Chapman; Hall/CRC. <a href="https://github.com/rstudio/bookdown">https://github.com/rstudio/bookdown</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#making-a-diagram-with-diagrammer">Making a diagram with DiagrammeR</a></li>
      <li><a href="#exporting-a-grvis-object-to-image-files">Exporting a <code>grVis</code> object to image files</a></li>
      <li><a href="#including-the-image-in-the-book">Including the image in the book</a></li>
      <li><a href="#so-lets-make-this-into-a-function">So let’s make this into a function!</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dipti Muni, Mary Anne Thygesen, Sophie Yang, Jim Tyhurst, John David Smith, M. Edward (Ed) Borasky.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
